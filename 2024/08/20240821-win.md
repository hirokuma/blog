# Windows11でPNGだけサムネイルが表示されなくなった(未解決)

<i>2024/08/21</i>

[X](https://x.com/hiro99ma/status/1825742753306914823)でもちょっと書いたが、Windows11でPNGだけサムネイルが表示されなくなった。
こんな感じでサムネイルもプレビューも表示されない。
赤いキャラクターが表示されているのは[IrfanView](https://www.irfanview.com/)というビュアーをデフォルトに設定しているためである。Windows付属のフォトにしていると何も表示されない。

![image](20240821a-1.png)

不思議なのは、JPEGやGIFは表示されるし、PDFやKritaのようにアプリがサムネイルを作っているものも表示されるのだが、PNGだけダメなのだ。
PNGファイルを標準のフォトアプリで開くと、そのフォルダ内のPNGファイルだけはサムネイルが作成される。他のアプリだとダメそうだし、他のフォルダには影響がない。  
この状態で何が面倒かというと、Execl で画像ファイルを挿入しようとしてもクリップアートのようにファイルが大量にある場合はどれだか見分けが付かないのだ。

現象としてはWindows10時代からあるようで、検索するといろいろ出てくる。

[DuckDuckGo "windows 11 png thumbnails not showing"](https://duckduckgo.com/?q=windows+11+png+thumbnails+not+showing&t=newext&atb=v440-7__&ia=web)

最初に出てくるのはエクスプローラーの設定がそうなっている場合の話である。
パフォーマンスオプションにも同じような設定がある。
が、他のサムネイルは表示されているのでこれではない。

次に出てくるのは`IconCache.db`を削除して再作成する方法である。
`thumbcache*.db`を削除するというのもある。
[Everything](https://www.voidtools.com/support/everything/)などを使っていると探すのが楽だろう。  
`IconCache.db`はユーザ権限で削除できるのだが`thumbcache*.db`はエクスプローラが開いているので管理者権限がいる場合があった。`DEL`みたいな組み込みコマンドだと`sudo`が使えないので面倒だ。
これは Windowsの設定アプリからもできるんじゃないかと思ったがよくわからん(設定>システム>ストレージ>一時ファイル>"縮小表示"にチェックしてファイルの削除)。
標準のディスククリーンアップからも同じようなことができる。  
そして、私の場合は効果がなかった。
いや、先ほど標準フォトでPNGを開くとフォルダ内のPNGはサムネイルが表示されると書いたが、あれが消えるのでキャッシュが削除されたというのは間違いないだろう。
それによってPNGのサムネイルが作成される効果がないというだけである。  
この状態で、大アイコン表示にしているエクスプローラで標準フォトからPNGファイルを開くと `iconcache_256.db` のファイルサイズが増えた。

PNGの標準アプリをフォトにすればよいのではと思ったのだが、関係なかった。
まあ、それならJPEGなども別あぷりにしているのにサムネイルが作成される説明が付かないから仕方ない。

キャッシュファイルを削除した後でエクスプローラで画像があるフォルダを選択すると、JPEGなどはちょっとの間だけアプリアイコンが表示された後にサムネイルが表示されている。
キャッシュを読むのが遅れているというよりも、その場でサムネイルを作成しているという方が理屈に合うと思う。
そうでないと全部のディスクをさらってサムネイルを作るなんていう時間がかかるし表示するつもりがない画像にもサムネイルを作ることになってスペースを無駄に消費することになるし。

となると、なぜかは知らないがPNGだけサムネイルを作成するフィルターから外されていることになる。
JPEGなども標準フォトではないアプリを割り当てているので、デフォルトアプリが影響しているとは思えない。
ならばもうシステム側の問題だろう。最初からそうではあるのだが。

`SFC`やら`DSIM`やらも試したが、全部ダメだった。
なんとかしてくれー。

解決法として「そりゃないんじゃないの」と思うのが Windowsのユーザプロファイルを再作成する方法である。
たしかに解決するかもしれないが、そのコストはかなりなものだ。

今日はあきらめた。
